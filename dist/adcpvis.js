!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ADCPvis=t():e.ADCPvis=t()}(this,(function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t){function i(e,t){t=t||{};const i=document.getElementById(e);this.container=document.createElement("div"),this.width=t.width||300,this.height=t.height||300,this.container.style.width=this.width+"px",i.appendChild(this.container),this.cube_urls=t.cube_urls||["wnx.jpg","wnx.jpg","wpy.jpg","wnz.jpg","wnx.jpg","wnx.jpg"].map(e=>"https://irishmarineinstitute.github.io/adcpvis/"+e),this.velocities=void 0,this.spheres=[],this.camera=new THREE.PerspectiveCamera(60,this.width/this.height,1,1e5),this.camera.position.z=12e3,this.scene=new THREE.Scene,this.renderer=new THREE.WebGLRenderer,this.renderer.setPixelRatio(this.width/this.height),this.renderer.setSize(this.width,this.height),this.container.appendChild(this.renderer.domElement),this.controls=new THREE.OrbitControls(this.camera,this.renderer.domElement),this.controls.enableZoom=!0,this._animate=this.animate.bind(this),this.date_label=document.createElement("h4"),this.date_label.style.width="100%",this.date_label.style["text-align"]="center",this.container.appendChild(this.date_label),this.range_control=document.createElement("input"),this.range_control.type="range",this.range_control.style["z-index"]=1,this.range_control.style.bottom="10px",this.range_control.style.width="100%",this.range_control.min=0,this.range_control.max=0,this.range_control.value=0,this.range_control.addEventListener("change",function(e){this._setPD0(e.target.value)}.bind(this)),this.pd0s=[],this.container.appendChild(this.range_control);let n=document.createElement("label");n.innerText="Upload your own pd0 file";let r=document.createElement("input");r.type="file";let s=this.setPD0s.bind(this);r.onchange=function(e){var t=new FileReader;t.onload=function(){var e=new Uint8Array(this.result);(new pd0parser).parse(e).then(s).catch(e=>console.log(e))},t.readAsArrayBuffer(e.target.files[0])},n.appendChild(r),this.container.appendChild(r)}"undefined"!=typeof THREE&&void 0!==THREE.OrbitControls&&"undefined"!=typeof pd0parser||console.log('ERROR: Developer you must include these lines in your html before adcpvis\n    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.js"><\/script>\n    <script src="https://threejs.org/examples/js/controls/OrbitControls.js"><\/script>       \n    <script src="https://irishmarineinstitute.github.io/pd0-parser/dist/pd0parser.js"><\/script>\n        '),i.prototype.setPD0s=function(e){this.pd0s=e.filter(e=>e.velocity&&e.velocity.data&&e.velocity.data.length),this.pd0s&&this.pd0s.length&&(this.range_control.setAttribute("max",this.pd0s.length-1),this.range_control.setAttribute("value",0),this.range_control.style.visibility=this.pd0s.length>1?"visible":"hidden",this._setPD0(0))},i.prototype._setPD0=function(e){if(this.pd0s&&this.pd0s.length){e=Math.min(e,this.pd0s.length-1);let t=this.pd0s[e];this.setVelocities(t.velocity.data),this.date_label.innerText=t.timestamp?t.timestamp:""}},i.prototype.setVelocities=function(e){e&&(this.velocities||(this.init(e),this.animate()),this.velocities=e)},i.prototype.init=function(e){this.velocities=e;var t=(new THREE.CubeTextureLoader).load(this.cube_urls);t.mapping=THREE.CubeRefractionMapping;var i=new THREE.MeshBasicMaterial({wireframe:!0,opacity:.1,color:0,transparent:!0});new THREE.MeshLambertMaterial({color:16777215,envMap:t,opacity:.1,transparent:!0,wireframe:!0});(s=new THREE.Mesh(new THREE.CylinderGeometry(100,100,1e4,16,1,!0),i)).renderDepth=-1.1,this.scene.add(s);i=new THREE.MeshBasicMaterial({color:16777215,envMap:t,refractionRatio:.7});for(var n=25*this.velocities.length,r=0;r<n;r++){var s,o=new THREE.SphereBufferGeometry(80*Math.random()+20,32,16),a=r%this.velocities.length,h=this.velocities[a],l=Math.random();(s=new THREE.Mesh(o,i)).position.x=0,s.position.y=this.calculateBinPosition(this.velocities.length,a),s.position.z=0;var c=h[0],p=h[1],d=h[2],u=Math.max(c,p),f=u<0?-1:1;s.position.x=c*l*5e3/u*f,s.position.z=p*l*5e3/u*f,s.position.y+=d*l*5e3/u*f,this.scene.add(s),this.spheres.push(s)}var m=THREE.ShaderLib.cube;m.uniforms.tCube.value=t,i=new THREE.ShaderMaterial({fragmentShader:m.fragmentShader,vertexShader:m.vertexShader,uniforms:m.uniforms,side:THREE.BackSide}),s=new THREE.Mesh(new THREE.BoxGeometry(1e5,1e5,1e5),i),this.scene.add(s)},i.prototype.calculateBinPosition=function(e,t){return 350*t-e/2*350},i.prototype.animate=function(){requestAnimationFrame(this._animate),this.render(),this.controls.update()},i.prototype.render=function(){Date.now();for(var e=0,t=this.spheres.length;e<t;e++){var i=e%this.velocities.length,n=this.velocities[i],r=this.spheres[e];r.position.x+=n[0]/10,r.position.z+=n[1]/10,r.position.y+=n[2]/10,(Math.abs(r.position.x)>5e3||Math.abs(r.position.z)>5e3)&&(r.position.x=0,r.position.z=0,r.position.y=this.calculateBinPosition(this.velocities.length,i))}this.renderer.render(this.scene,this.camera)},i.prototype.fetchPd0=function(e){fetch(e).then(e=>e.arrayBuffer()).then(e=>new Uint8Array(e)).then(e=>(new pd0parser).parse(e)).then(e=>e.filter(e=>e.velocity)).then(this.setPD0s.bind(this)).catch(t=>{console.log("error processing ["+e+"]",t)})},e.exports=i}])}));